<?xml version="1.0" encoding="utf-8"?>
<!-- This file is part of the DITA Open Toolkit project hosted on 
     Sourceforge.net. See the accompanying license.txt file for 
     applicable licenses.-->
<!-- (C) Copyright IBM Corporation 2005. All Rights Reserved.
 *-->
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="preprocessarch" xml:lang="en-us">
<title>DITA pre-processing architecture</title>
<shortdesc>This document describes the different steps in preprocessing for
DITA topics.</shortdesc>
<conbody>
  <p>The DITA Toolkit implements a two-stage, map-driven architecture that 
    resolves any conditional properties and content references on the first 
    pass, then applies transformations to the normalized files on the second 
    pass. The stages of this pre-processing pipeline are described below.</p>
  <section>
    <title><apiname>genlist</apiname>: generate list files of map and 
      topic</title>
    <p>Pass the files and generate list files that may be needed by other 
      activity.<i>(Implemented by ANT extension with Java.)</i>The result of 
      the genlist module is contained in file, dita.list, in temp directory. 
      Dita.list file contains following properties that can be used in the ant 
      processing.</p>
    <p>
      <table>
        <title></title>
        <tgroup cols="2">
          <colspec colname="col1"/>
          <colspec colname="col2"/>
          <thead>
            <row valign="bottom">
              <entry colname="col1">Property Name</entry>
              <entry colname="col2">Usage</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry colname="col1">conreflist</entry>
              <entry colname="col2">Files that contains conref attribute that 
                need to be resolved in preprocess.</entry>
            </row>
            <row>
              <entry colname="col1">fullditamapandtopiclist</entry>
              <entry colname="col2">All of the ditamap and topic files that are 
                referred to in the transformation. (No matter referred by href 
                or conref)</entry>
            </row>
            <row>
              <entry colname="col1">fullditamaplist</entry>
              <entry colname="col2">All of the ditamap files in 
                dita.list</entry>
            </row>
            <row>
              <entry colname="col1">hrefditatopiclist</entry>
              <entry colname="col2">All of the topic files that are referred to 
                by href</entry>
            </row>
            <row>
              <entry colname="col1">fullditatopiclist</entry>
              <entry colname="col2">All of the topic files in dita.list</entry>
            </row>
            <row>
              <entry colname="col1">imagelist</entry>
              <entry colname="col2">Images files that is referred to by topic 
                files</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </p>
  </section>
  <section>
    <title>filtering:</title>
    <p>Filter the source files according to the input 
      <filepath>.ditaval</filepath> file. Based on the specified action, either 
      flag or exclude the content according to the %select-atts. 
      <i>(Implemented by Java.)</i></p>
  </section>
  <section>
    <title>insert debug information (merged into filtering):</title>
    <p>Add @xtrf and @xtrc attribute with proper values into each 
      element.<i>(Implemented by Java.)</i></p>
    <p>
      <i>The output of this step is directed to a temp directory.</i>
    </p>
  </section>
  <section>
    <title>adjust column names of table (merged into conref resolve 
      activity):</title>
    <p>Adjust all of the column names of the tables to &quot;col1, col2, col3 
      ...&quot; to enable conref between tables.<i>(Implemented by 
      XSL-T.)</i></p>
    <p>
      <i>The colname attribute is adjusted in the content that was conrefed 
        during the process of resolving conref.</i>
    </p>
  </section>
  <section>
    <title>move index entries:</title>
    <p>Move the index entries contained in the &lt;topicmeta&gt; tag into the 
      relevant topics referred to in the ditamap.<i>(Implemented implemented by 
      Java<?Pub Caret?>.)</i></p>
  </section>
  <section>
    <title>resolve conref:</title>
    <p>Pass all the files which used conref and resolve the 
      conref.<i>(Implemented by XSL-T)</i></p>
  </section>
  <section>
    <title>mappull:</title>
    <p>Pull the navtitle and topicmeta from topics to ditamap<i>(Implemented by 
      XSL-T)</i></p>
  </section>
  <section>
    <title>topicpull:</title>
    <p>Pull metadata for &lt;link&gt; and &lt;xref&gt; element<i>(Implemented 
      by XSL-T)</i></p>
  </section>
  <section>
    <title>maplink:</title>
    <p>Find and generate related link information into maplinks.unordered for 
      every topic referred to in the ditamap <i>(Implemented by XSL-T)</i></p>
  </section>
  <section>
    <title>movelink:</title>
    <p>Move the related link information from the maplinks.unordered to every 
      topic <i>(Implemented in Java)</i></p>
  </section>
  <section>
    <image href="preprocess.gif"></image>
  </section>
</conbody>
</concept>