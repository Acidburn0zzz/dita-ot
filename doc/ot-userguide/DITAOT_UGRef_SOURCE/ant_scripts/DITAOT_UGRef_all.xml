<?xml version="1.0" encoding="UTF-8" ?>
<!-- (c) Copyright VR Communications, Inc. All Rights Reserved. -->
<!-- Ant script for the DITA Open Toolkit User Guide and Reference (DITAOT_UGRef) -->
<project name="toolkitug" default="xhtml">

  <echo>Building DITA Open Toolkit User Guide.</echo>

  <!-- allow access to environment variables -->
  <property environment="env"/>

  <!-- set toolkit directory from environment variable -->
  <!-- Note: basedir is set in the script that invokes this
             one. It is not used here, but some plugins depend
             on it pointing to the Toolkit directory.  -->
  <property name="toolkit_dir" value="${env.DITA_DIR}"/>

  <!-- project global properties relative to the location of this script -->
  <property name="projdir" value="${ant.file}/../.."/>
  <property name="outdir" value="${projdir}/../DITAOT_UGRef_OUTPUT"/>
  <property name="PHPexe" value="C:/wamp/php/php.exe"/>
  <property name="args.logdir" value="${outdir}"/>
  <property name="MAP_file" value="DITAOT_UGRef.ditamap"/>
  <property name="EXTNAME" value=".dita"/>

  <!-- file for using otherprops filtering for non-pdf output -->
  <property name="ditaval_nonpdf" value="${projdir}/ditaval_files/otherprops_filtering.ditaval"/>


  <!-- define path to Java code -->
  <path id="dost.class.path">
    <pathelement location="${toolkit_dir}${file.separator}lib${file.separator}dost.jar"/>
  </path>
  
  <!-- define the Ant targets and initialize the processing environment -->
  <taskdef name="integrate" classname="org.dita.dost.platform.IntegratorTask">
    <classpath refid="dost.class.path"/>
  </taskdef>

  <!-- create the default XHTML output and debug cross-reference -->
  <target name="xhtml" depends="integrate, ditadebug, ditalinks, dita2xhtml">
  </target>
  <target name="integrate">
    <integrate ditadir="${toolkit_dir}"/>
  </target>
  
  <!-- create all output types -->
  <target name="alltargets" depends="integrate, dita2xhtml, dita2htmlhelp, 
     dita2troff, dita2docbook, dita2javahelp, dita2wordrtf, dita2eclipsecontent,
     dita2eclipsehelp, dita2pdf2">
  </target>
  <!-- handy abbreviation -->
  <target name="all" depends="allreports, alltargets" />
  
  <!-- create all reports -->
  <target name="allreports" depends="ditadebug, ditalinks, ditaauthors, ditaids, ditakeys" />
  
  <!-- create the ditamap debug cross-reference -->
  <target name="ditadebug">
    <echo>Building debugging cross-reference file ditadebug.txt</echo>
    <mkdir dir="${outdir}/debug_files"/>
    <exec executable="${PHPexe}" dir = "${projdir}" output="${outdir}/debug_files/ditadebug.txt">
      <arg value="${projdir}/project/tools/ditadebug.php"/>
      <arg value="${MAP_file}"/>
    </exec>
  </target>

  <!-- create plausible preview -->
  <target name="preview">
    <echo>Building XHTML plausible preview</echo>
    <mkdir dir="${outdir}/debug_files"/>
    <exec executable="${PHPexe}" dir = "${projdir}" output="${outdir}/debug_files/ditapreview.txt">
      <arg value="${projdir}/project/tools/ditapreview.php"/>
      <arg value="${MAP_file}"/>
      <arg value="L"/>
    </exec>
  </target>

  <!-- create the ditamap URL check -->
  <target name="ditalinks">
    <echo>Building URL check file ditalinks.txt</echo>
    <mkdir dir="${outdir}/debug_files"/>
    <exec executable="${PHPexe}" dir = "${projdir}" output="${outdir}/debug_files/ditalinks.txt">
      <arg value="${projdir}/project/tools/ditalinks.php"/>
      <arg value="${MAP_file}"/>
    </exec>
  </target>

  <!-- create the ditamap author and copyright statistics -->
  <target name="ditaauthors">
    <echo>Building author/copyright file ditaauth.txt</echo>
    <mkdir dir="${outdir}/debug_files"/>
    <exec executable="${PHPexe}" dir = "${projdir}" output="${outdir}/debug_files/ditaauthors.txt">
      <arg value="${projdir}/project/tools/ditaauthors.php"/>
      <arg value="${MAP_file}"/>
    </exec>
  </target>

  <!-- create the ditamap ID listing  -->
  <target name="ditaids">
    <echo>Building ID list file ditaids.txt</echo>
    <mkdir dir="${outdir}/debug_files"/>
    <exec executable="${PHPexe}" dir = "${projdir}" output="${outdir}/debug_files/ditaids.txt">
      <arg value="${projdir}/project/tools/ditaids.php"/>
      <arg value="${MAP_file}"/>
    </exec>
  </target>

  <!-- create the ditamap keyword metadata statistics -->
  <target name="ditakeys">
    <echo>Building keyword metadata file ditakeys.txt</echo>
    <mkdir dir="${outdir}/debug_files"/>
    <exec executable="${PHPexe}" dir = "${projdir}" output="${outdir}/debug_files/ditakeys.txt">
      <arg value="${projdir}/project/tools/ditakeys.php"/>
      <arg value="${MAP_file}"/>
    </exec>
  </target>

  <!-- create xhtml output -->
  <target name="dita2xhtml">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/xhtml"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="xhtml"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="args.css" value="${projdir}/css_files/DITAOT_UGRef_CSS.css"/>
      <property name="args.csspath" value="CSS"/>
      <property name="args.copycss" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
      <property name="dita.input.valfile" value="${ditaval_nonpdf}"/>
    </ant>
    <!-- copy entire set of garage sample files as DITA files (these should not be processed) -->   
    <!-- <copy todir="${outdir}/garage"> 
      <fileset dir="${projdir}/samples/samplefiles/garage"/>
    </copy> -->
  </target>

  <!-- create htmlhelp output -->
  <target name="dita2htmlhelp">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/htmlhelp"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="htmlhelp"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="args.css" value="${projdir}/css_files/DITAOT_UGRef_CSS.css"/>
      <property name="args.csspath" value="CSS"/>
      <property name="args.copycss" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
      <property name="dita.input.valfile" value="${ditaval_nonpdf}"/>
    </ant>
  </target>

  <!-- create tocjs output -->
  <target name="dita2tocjs">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/tocjs"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="tocjs"/>
      <property name="clean.temp" value="no"/>
      <property name="args.css" value="${projdir}/css_files/DITAOT_UGRef_CSS.css"/>
      <property name="args.csspath" value="CSS"/>
      <property name="args.copycss" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
      <property name="dita.input.valfile" value="${ditaval_nonpdf}"/>
    </ant>
  </target>

  <!-- create pdf output -->
  <target name="dita2pdf">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/pdf"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="pdf"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
 <!-- <property name="args.xsl" value="${toolkit_dir}/xsl/xdita2fo-shell.xsl"/> -->
      <property name="dita.extname" value="${EXTNAME}"/>
    </ant>
  </target>

  <!-- create docbook output -->
  <target name="dita2docbook">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/docbook"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="docbook"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
    </ant>
  </target>

  <!-- create javahelp output -->
  <target name="dita2javahelp">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/javahelp"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="javahelp"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
      <property name="dita.input.valfile" value="${ditaval_nonpdf}"/>
    </ant>
  </target>

  <!-- create troff output -->
  <target name="dita2troff">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/troff"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="troff"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
    </ant>
  </target>

  <!-- create wordrtf output -->
  <target name="dita2wordrtf">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/wordrtf"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="wordrtf"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
    </ant>
  </target>

  <!-- create eclipsecontent output -->
  <target name="dita2eclipsecontent">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/eclipsecontent"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="eclipsecontent"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
    </ant>
  </target>

  <!-- create eclipsehelp output -->
  <target name="dita2eclipsehelp">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/eclipsehelp"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="eclipsehelp"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
    </ant>
  </target>

  <!-- create FrameMaker Adapter output -->
  <target name="dita2fmxml">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/fmxml"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="fmxml"/>
      <property name="dita.extname" value="${EXTNAME}"/>
    </ant>
  </target>

  <!-- create Idiom FO output -->
  <target name="dita2pdf2">
    <ant antfile="${toolkit_dir}${file.separator}conductor.xml" target="init">
      <property name="args.input" value="${projdir}/${MAP_file}"/>
      <property name="output.dir" value="${outdir}/pdf2"/>
      <property name="dita.temp.dir" value="${outdir}/temp"/>
      <property name="transtype" value="pdf2"/>
      <property name="args.draft" value="yes"/>
      <property name="args.indexshow" value="yes"/>
      <property name="dita.extname" value="${EXTNAME}"/>
    </ant>
  </target>

</project>
